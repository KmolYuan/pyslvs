# Travis-Ci for Pyslvs
language: python

matrix:
  include:

    - &linux
      os: linux
      sudo: required
      python: "3.6"
      dist: bionic
      deploy:
        provider: pypi
        user: $TWINE_USERNAME
        password: $TWINE_PASSWORD
        skip_cleanup: true
        skip_existing: true
        file: dist/*.whl
        on:
          tags: true

    - <<: *linux
      python: "3.7"

    - <<: *linux
      python: "3.8-dev"

    - &osx
      os: osx
      osx_image: xcode10
      language: generic
      env: PYTHON=3.6.0
      before_install:
        - brew update
        - brew upgrade pyenv
        - export PATH="/Users/travis/.pyenv/shims:${PATH}"
        - pyenv install ${PYTHON}
        - pyenv global ${PYTHON}
        - python3 -m pip install pip -U
        - python3 --version
        - python3 -m pip --version
        - python3 -m pip install -r requirements.txt
      after_success:
        # PyPI deployment
        - if [ -n "$TRAVIS_TAG" ]; then
          python3 -m pip install twine;
          python3 setup.py sdist bdist_wheel;
          python3 -m twine upload dist/*.whl --skip-existing;
          fi

    - <<: *osx
      env: PYTHON=3.7.0

    - <<: *osx
      env: PYTHON=3.8-dev

script:
  - python3 setup.py test

before_cache:
  - rm -rf $HOME/.cache/pip/log

cache:
  directories:
    - $HOME/.cache/pip
