# Travis-Ci for Pyslvs
language: python

matrix:
    include:

        - os: linux
          sudo: required
          python: "3.6"
          dist: xenial
          deploy: &deploy-options
              provider: pypi
              user: $TWINE_USERNAME
              password: $TWINE_PASSWORD
              skip_cleanup: true
              skip_existing: true
              on:
                  tags: true

        - os: linux
          sudo: required
          python: "3.7"
          dist: xenial
          deploy:
              <<: *deploy-options

        - os: osx
          osx_image: xcode10
          language: generic
          env: PYTHON=36

        - os: osx
          osx_image: xcode10
          language: generic
          env: PYTHON=37
          deploy:

# For OS X
before_install:

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        curl -LO https://raw.githubusercontent.com/GiovanniBussi/macports-ci/master/macports-ci;
        source ./macports-ci install;
        fi

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        yes | sudo port install python$PYTHON;
        yes | sudo port install py$PYTHON-pip;
        sudo port select --set python3 python$PYTHON;
        sudo port select --set pip pip$PYTHON;
        fi

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        python3 --version;
        python3 -m pip --version;
        fi

    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        python3 -m pip install -r requirements.txt --user;
        fi

script:
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        python3 setup.py install --user;
        else
        python3 setup.py install;
        fi
    - python3 tests

before_cache:
    - rm -rf $HOME/.cache/pip/log

cache:
    directories:
        - $HOME/.cache/pip

after_success:
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        if [ -n "$TRAVIS_TAG" ]; then
            python3 -m pip install twine --user;
            python3 setup.py sdist bdist_wheel;
            python3 -m twine upload dist/*.whl --skip-existing;
        fi
        fi
