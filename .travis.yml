# Travis-Ci for Pyslvs
language: python

matrix:
  include:

    - os: linux
      sudo: required
      python: "3.6"
      dist: xenial
      deploy: &deploy-options
        provider: pypi
        user: $TWINE_USERNAME
        password: $TWINE_PASSWORD
        skip_cleanup: true
        skip_existing: true
        on:
          tags: true

    - os: linux
      sudo: required
      python: "3.7"
      dist: xenial
      deploy:
        <<: *deploy-options

    - os: linux
      sudo: required
      python: "3.8-dev"
      dist: xenial
      deploy:
        <<: *deploy-options

    - os: osx
      osx_image: xcode10
      language: generic
      env: PYTHON=3.6.0

    - os: osx
      osx_image: xcode10
      language: generic
      env: PYTHON=3.7.0

    - os: osx
      osx_image: xcode10
      language: generic
      env: PYTHON=3.8-dev

# For OS X
before_install:

  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    brew update;
    brew upgrade pyenv;
    export PATH="/Users/travis/.pyenv/shims:${PATH}";
    pyenv install ${PYTHON};
    pyenv global ${PYTHON};
    python3 -m pip install pip -U;
    fi

  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    python3 --version;
    python3 -m pip --version;
    fi

  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
    python3 -m pip install -r requirements.txt;
    fi

script:
  - python3 setup.py test

before_cache:
  - rm -rf $HOME/.cache/pip/log

cache:
  directories:
    - $HOME/.cache/pip

after_success:
  - if [[ "$TRAVIS_OS_NAME" == "osx" && -n "$TRAVIS_TAG" ]]; then
    python3 -m pip install twine;
    python3 setup.py sdist bdist_wheel;
    python3 -m twine upload dist/*.whl --skip-existing;
    fi
